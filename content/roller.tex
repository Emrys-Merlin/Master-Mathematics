\section{Pocsets and the Roller compactification}
\label{sec:roller}
This whole chapter is dedicated to the interplay between CAT(0) cube complexes and discrete pocsets. \textcite{Roller1999} showed that there is a one-to-one-correspondence between these two points of view, which is an important tool in this field of study.

This chapter is divided into five sections. In Section~\ref{sec:pocset}, we will introduce \emph{pocsets} and \emph{ultrafilters}, which are the main ingredients in the so-called \emph{Roller compactification} of the vertex set of a CAT(0) cube complex. This compactification is described in detail in Section~\ref{sec:rb}. Section~\ref{sec:set-ultrafilters} is again concerned with ultrafilters. There are two equivalent ways to define them and we will need both. The first viewpoint (in Section~\ref{sec:pocset}) has advantages when it comes to topological and metrical properties of the Roller compactification, whereas the second viewpoint (in Section~\ref{sec:set-ultrafilters}) is more natural when it comes to measurability. The main result in Section~\ref{sec:set-ultrafilters} is Theorem~\ref{thm:uf-equivalence}, showing that the two viewpoints are equivalent.
Section~\ref{sec:terminal-elements} is only loosely related to the previous sections. We will introduce \emph{intervals} of ultrafilters, which are special subcomplexes of CAT(0) cube complexes. The most interesting property of these intervals is that they are always embeddable into some \(\R^d\) (considered as a CAT(0) cube complex, see Example~\ref{bsp:ccc-torus}). The second topic of the section are so-called \emph{terminal elements}. These are all the elements in a set of halfspaces that are minimal or maximal with regard to inclusion. The existence or non-existence of these elements is one cornerstone of the main proof. Intervals have at most finitely many terminal elements (c.\,f.\ Example~\ref{bsp:finite-terminal}) which is why they are so interesting for us.
In Section~\ref{sec:embedding-roller}, we are interested in one special case of the above mentioned correspondence between pocsets and CAT(0) cube complexes: If \(\mathcal{H'} \subset \mathcal{H}\) are both pocsets, under which circumstances will the associated complex \(X(\mathcal{H}')\) be a subcomplex of \(X(\mathcal{H})\)? We will be able to give a partial answer by providing a sufficient condition (which, however, might not be necessary).

\subsection{Pocsets and ultrafilters}
\label{sec:pocset}

In this section we will introduce a special type of partially ordered sets (or short: \emph{posets}). These sets are special because they have a certain fixed point free involution. They are called \emph{pocsets} (a poset with \enquote{complementation}). After having established this notion, we will introduce \emph{ultrafilters} which are the necessary objects to construct a compactification of the vertex set of a CAT(0) cube complex. In this section, we will mostly be interested in topological and metric properties of the set of all ultrafilters. The connection to CAT(0) cube complexes will be established at the end of this section.

\begin{defin}[Pocset, {\cite{Roller1999}}]~\vspace{-6pt}
  \begin{itemize}
  \item A \emph{pocset} is a triple \((A, \prec, \ast)\) consisting of a set \(A\), a partial ordering \(\prec\) on \(A\) and a fixed point free, order reversing involution
    \begin{align*}
      \ast\colon A &\to A,\\
      a &\mapsto a^\ast
    \end{align*}
    such that \(a\) and \(a^\ast\) are incomparable for every \(a \in A\). If there is no danger of ambiguity, we will often drop the triple and we will write \(A\) for short.

    Let \(A,B\) be pocsets. The map \(f \colon A \to B\) is called a \emph{pocset morphism} if the following conditions hold:
    \begin{enumerate}
    \item \(a \prec b\) implies that \(f(a) \prec f(a)\) for every \(a,b \in A\), and
    \item \(f(a^\ast) = f(a)^\ast\) for every \(a \in A\). 
    \end{enumerate}
  \item A pocset \(A\) is called \emph{discrete} if for any two \(a, b \in A\) the \emph{interval}
    \[
      [a,b] \coloneqq \{c \in A \mid a \prec c \prec b\}
    \]
    is finite.
  \item Two elements \(a,b\) of a pocset \(A\) are called \emph{nested} if they satisfy \(a \prec b\), \(a^\ast \prec b\), \(a \prec b^\ast\) or \(a^\ast \prec b^\ast\). Otherwise, they are called \emph{transverse}.
  \item A pocset \(A\) has \emph{finite width} if there exists a constant \(N \in \N\) such that the cardinality of any subset of transverse elements of \(A\) is bounded from above by \(N\).
  \end{itemize}
\end{defin}

\begin{defin}[Ultrafilter]
  Let \((A, \prec, \ast)\) be a pocset. Let \(\tilde A\) be the set of equivalence classes via: \(a \sim b\) if and only if \(a^\ast = b\) or \(a = b\). We define
  \[
    P(A) \coloneqq \prod_{\tilde a \in \tilde A} \tilde a,
  \]
  i.\,e.\ \(P(A)\) is the product over all the two element sets containing an element of \(A\) and its opposite under involution. Let \(\alpha \in P(A)\). The notation \enquote{\(a \in \alpha\)} for some \(a \in A\) means that the natural projection \(P(A) \to \tilde a\) maps \(\alpha\) to \(a\) (instead of to \(a^\ast\)). With this notation introduced, we define:
  
  An element \(\alpha \in P(A)\) is called an \emph{ultrafilter} if it satisfies the so called \emph{consistency condition}, namely: If \(a \in \alpha\) and \(b \in A\) such that \(a \prec b\) then \(b \in \alpha\).

  We denote by \(\mathcal{U}(A) \subset P(A)\) the subset of all ultrafilters. We put on every \(\tilde a\) the discrete topology. By Tychonoff's theorem (c.\,f.\ \cite[Chapter~10]{MR1275831}) \(P(A)\) is compact. A basis of the topology is given by the sets of the form
\[
  \mathcal{U}(a_1,\dots, a_n) \coloneqq \{\alpha \in P(A) \mid a_1, \dots, a_n \in \alpha\},
\]
where \(a_1,\dots, a_n \in A\) are arbitrary elements.
\end{defin}

We will postpone an example until we have introduce the pocset of halfspaces of a CAT(0) cube complex in Proposition~\ref{prop:pocset-halfspaces}.

% \begin{defin}
%   Let \(\alpha\) be an ultrafilter and \(\mathfrak{h}_1, \dots, \mathfrak{h}_n \in \alpha\). Then \(\alpha; \mathfrak{h}_1, \dots, \mathfrak{h}_n \in P(A)\) is defined by replacing each \(\mathfrak{h}_i\) in \(\alpha\) by \(\mathfrak{h_i}^\ast\).
% \end{defin}

% \begin{lemma}
%   Let \(\alpha\) be an ultrafilter and \(\mathfrak{h} \in \alpha\). Then \((\alpha;\mathfrak{h})\) is an ultrafilter if and only if \(\mathfrak{h}\) is minimal, i.\,e.\ if \(\mathfrak{h}' \in \alpha\) satisfies \(\mathfrak{h'} \subset \mathfrak{h}\) then \(\mathfrak{h'} = \mathfrak{h}\) holds.
% \end{lemma}

% \begin{proof}
%   First, consider the case that \(\beta \coloneqq (\alpha, \mathfrak{h})\) is an ultrafilter. Let \(\mathfrak{h}' \in \alpha\) such that \(\mathfrak{h}' \subset \mathfrak{h}\). Equivalently this means \(\mathfrak{h}^\ast \subset \mathfrak{h}'^\ast\). Since \(\beta\) is an ultrafilter, it follows that \(\mathfrak{h}'^\ast \in \beta\). However, this is only possible if \(\mathfrak{h} = \mathfrak{h}'\), since otherwise \(\beta\) would have to contain both \(\mathfrak{h}' \) and \(\mathfrak{h}'^\ast\).

%   Now, consider that \(\mathfrak{h} \in \alpha\) is minimal. Let \(\mathfrak{h}' \in \beta\) and \(\mathfrak{\tilde h}\) be any halfspace with \(\mathfrak{h}' \subset \mathfrak{\tilde h}\). If \(\mathfrak{h}' \neq \mathfrak{h}\) then \(\mathfrak{h}' \in \alpha \) and hence \(\mathfrak{\tilde h} \in \alpha\). Additionally, \(\mathfrak{\tilde h} \neq \mathfrak{h}\) and it follows that \(\mathfrak{\tilde h} \in \beta\). If \(\mathfrak{h}' = \mathfrak{h}\) then it follows that \(\mathfrak{\tilde h}^\ast \subset \mathfrak{h}\) and thus we have equality. Showing again that \(\mathfrak{\tilde h} = \mathfrak{h}^\ast \in \beta\).
% \end{proof}

\begin{prop}
  Let \(A\) be a pocset. The set of all ultrafilters \(\mathcal{U}(A)\) is a compact space.
\end{prop}

\begin{proof}
  Since \(P(A)\) is already compact it suffices to show that \(\mathcal{U}(A)\) is closed in \(P(A)\). However, the complement
  \begin{align*}
    P(A) \setminus \mathcal{U}(A)
    & = \{\alpha \in P(A) \mid \exists a, b \in A\colon a \in \alpha,\ b \notin \alpha,\ a \prec b\}\\
    & = \bigcup_{a \in A} \{\alpha \in P(A) \mid a \in \alpha,\ \exists b \in A\colon a \prec b,\ b \notin \alpha\}\\
    & = \bigcup_{a \in A} \{\alpha \in P(A) \mid a \in \alpha,\ \exists b \in A\colon a \prec b,\ b^\ast \in \alpha\}\\
    & = \bigcup_{a \in A} \bigcup_{a \prec b}\{\alpha \in P(A) \mid a \in \alpha,\ b^\ast \in \alpha\}\\
    & = \bigcup_{a \in A} \bigcup_{a \prec b}\mathcal{U}(a, b^\ast)
  \end{align*}
  is open, which proves the claim.
\end{proof}

\begin{cor}
  \label{cor:comp-met-2}
  If \(A\) is countable then \(\mathcal{U}(A)\) is a compact metrizable space. 
\end{cor}

\begin{proof}
  By \textcite[Theorem~4.2.2]{Engelking} it holds that every countable product of metrizable spaces leads to a metrizable space. Thus \(P(A)\) is compact and metrizable. Since \(\mathcal{U}(A)\) is a closed subset the same is true for this space.
\end{proof}


\subsubsection*{The pocset of halfspaces of a CAT(0) cube complex}
\label{pocset-halfspaces}

\begin{prop}
  \label{prop:pocset-halfspaces}
  Let \(X\) be a connected CAT(0) cube complex and \(\mathcal{H}\) its set of halfspaces. Furthermore, let
  \begin{align*}
    \ast \colon \mathcal{H} &\to \mathcal{H},\\
    \mathfrak{h} & \mapsto \mathfrak{h}^\ast.
  \end{align*}
  Then \((\mathcal{H}, \subset, \ast)\) is a discrete pocset. If \(X\) is finite-dimensional then \(\mathcal{H}\) has finite width.
\end{prop}

\begin{proof}
  Clearly, \((\mathcal{H}, \subset)\) is a partially ordered set and by definition \(\ast\) has no fixed points and is order reversing. Hence \(\mathcal{H}\) is a pocset. By Lemma~\ref{lem:finite-interval} it is discrete.

  Assume that \(\mathfrak{h}_1, \dots, \mathfrak{h}_n \in \mathcal{H}\) are transverse. Then they intersect pairwise and the same is true for the associated hyperplanes \(\mathfrak{\hat h}_i\). By Theorem~\ref{thm:common-intersection} the hyperplanes contain a common point. This point must lie in some cube \(C\) of \(X\) and in this cube all the hyperplanes are given by (transverse) midcubes. Hence \(\dim C \geq n\). We see that if \(X\) is finite-dimensional with \(\dim X = n\), then any subset of transverse elements of \(\mathcal{H}\) can have at most \(n\) elements. This proves that \(\mathcal{H}\) has finite width.
\end{proof}

\begin{rem}
  \label{rem:roller}
  In his habilitation \textcite{Roller1999} showed that there is a one-to-one-correspondence between discrete pocsets and CAT(0) cube complexes (the so-called \emph{Roller duality}). The direction from the complexes \(X\) to the pocsets has been realized in Proposition~\ref{prop:pocset-halfspaces}. The other way around is far more involved and makes heavy use of \emph{ultrafilters} as defined above. This \emph{Roller construction} is what lead to the \emph{Roller compactification} of every finite-dimensional CAT(0) cube complex.
\end{rem}

\begin{bsp}[Trees]
  We describe the ultrafilters in the case of a tree. There, each edge defines a unique hyperplane, and hence the choice of a halfspace is equivalent to assigning a direction to an edge. We agree that the arrow we assign to an edge will point towards the chosen halfspace. Since each ultrafilter contains either a halfspace or its complement, we have to assign an arrow to each edge. The consistency condition implies that if we have an outgoing edge at a vertex, then all other edges must be incoming. In other words, an ultrafilter converts our undirected tree into a directed one such that each vertex has at most one outgoing edge. An example of this can be found in Figure~\ref{fig:ultrafilter}.
  \begin{figure}[htbp]
    \centering
    \input{./images/tree.tex}
    \caption{A tree with inscribed ultrafilter}
    \label{fig:ultrafilter}
  \end{figure}

  This reformulation leads to another interesting observation. If all vertices have one outgoing edge, then we can start a geodesic ray from any vertex following the ultrafilter. Each of these geodesic rays will merge after finitely many steps and emanate on. Hence, each of these ultrafilters defines one element at the visual boundary of the tree (see Definition~\ref{defin:visual}). Additionally, one can convince oneself that the only other possibility is that there is exactly one vertex with no outgoing edge (c.\,f.~\cite[14]{sageev-lecture-notes}). Hence, these ultrafilters define a unique vertex in the tree. We see that for trees ultrafilters are a reformulation of the visual compactification of the CAT(0) space. 
\end{bsp}

\begin{cor}
  \label{cor:comp-met}
  If \(X\) is a locally countable CAT(0) cube complex and \(\mathcal{H}\) is its pocset of halfspaces then \(\mathcal{U}(\mathcal{H})\) is a compact metrizable space.
\end{cor}

\begin{proof}
  If \(X\) is locally countable, then the pocset \(\mathcal{H}\) is countable by Corollary~\ref{cor:halfspace-countable} and we can apply Corollary~\ref{cor:comp-met-2}.
\end{proof}

\begin{rem}
  We would like to point out that the countability of \(\mathcal{H}\) is the only place where the local countability of our CAT(0) cube complex \(X\) comes into play. However, it is essential at this place. Indeed, the metrizability of \(\mathcal{U}(\mathcal{H})\) is central in order for certain vector spaces of continuous functions to be separable. Otherwise, we could not construct the first part of our boundary map (see Theorem~\ref{thm:p(x)} and Corollary~\ref{cor:p(x)}).
\end{rem}

We will close this section with two results giving a criterion for reducibility of a CAT(0) cube complex \(X\) using a decomposition of the pocset of halfspaces \(\mathcal{H}(X)\).

\begin{prop}[{\cite[Lemma~2.5]{Caprace2010}}]
  A CAT(0) cube complex \(X\) is reducible, i.\,e.\ \(X\) splits as a (proper) product if and only if there exists a partition \(\mathcal{H}(X) = \mathcal{H}_1 \sqcup \mathcal{H}_2\) such that each halfspace in \(\mathcal{H}_1\) is transverse to each halfspace in \(\mathcal{H}_2\).
\end{prop}

\begin{proof}[Sketch]
  The key observation is that if we have two CAT(0) cube complexes \(X_1\) and \(X_2\) and we consider the cube complex \(X_1 \times X_2\), then the halfspaces take the form \(\mathfrak{h} \times X_2\) for any \(\mathfrak{h} \in \mathcal{H}(X_1)\) or \(X_1 \times \mathfrak{k}\) for any \(\mathfrak{k} \in \mathcal{H}(X_2)\). Any two of them will always be transverse. Thus, if \(X\) splits as a product, then this argument shows that we find the desired partition. If we have the partition, then the \(\mathcal{H}_i\) are pocsets. Hence, up to isomorphism, we find two unique CAT(0) cube complexes corresponding to the two pocsets and their product has the same set of halfspaces as \(X\). By the aforementioned uniqueness they have to be isomorphic.
\end{proof}

\begin{prop}[{\cite[Proposition~2.6]{Caprace2010}}]
  \label{prop:cs-2.6}
  Every finite-dimensional CAT(0) cube complex \(X\) admits a decomposition
  \[
    X = X_1 \times \dots \times X_m
  \]
  into a product of irreducible cube complexes \(X_i\). This decomposition is canonical up to permutation. Every automorphism of \(X\) preserves that decomposition, up to a permutation of possibly isomorphic factors. In particular, the image of the canonical embedding
  \[
    \Aut(X_1) \times \dots \times \Aut(X_m) \hookrightarrow \Aut(X)
  \]
  has finite index in \(\Aut(X)\).
\end{prop}

\subsection{The Roller compactification}
\label{sec:rb}

This section contains the connection between CAT(0) cube complexes, pocsets and ultrafilters leading directly to the \emph{Roller compactification}. This connection was first discovered by \textcite{Roller1999}. Hence, all constructions in this direction inherited his name. We will first define two special kinds of ultrafilters, the \emph{principal ultrafilters} and the \emph{non-terminating ultrafilters}. Afterwards, we will show how to embed the vertex set of a CAT(0) cube complex into its set of ultrafilters over the pocset of halfspaces. 

% The last part of this section is concerned with a second equivalent way to define ultrafilters. In the previous section we introduce them as a subset of a product space. Alternatively, one can define it as a subset of a power set. We will prove the equivalence of the two notions and from then on only use the point of view established in this section. The advantage is that it is often more natural to work in the subset context. Additionally, many of the maps in the later chapters concerning ultrafilters are defined in a \enquote{set context}, such that we cannot avoid talking about this construction. 

% For now, we denote by \(\mathcal{U}(X)\) the set of all ultrafilters of the pocset of halfspaces of \(X\). Next, consider \(\alpha, \beta \in \mathcal{U}(X)\) and define \(d(\alpha, \beta) \coloneqq \# \{ \mathfrak{h} \in \mathcal{H}(X)\mid \mathfrak{h} \in \alpha \wedge \mathfrak{h}^\ast \in \beta\}\). This is not a distance in the ordinary sense on \(\mathcal{U}(X)\) because it might take \(+\infty\) as a value. However, with its help we can define a graph \(G\) with the ultrafilters as its vertices and edges between \(\alpha\) and \(\beta\), whenever \(d(\alpha, \beta) = 1\).\todo{what do I want with this?}

% \begin{defin}
%   For any \(x \in X\), we define \(\alpha_x \in \mathcal{U}(X)\) by always choosing the halfspace containing \(x\). It follows readily from the definition that this is an ultrafilter. An ultrafilter that arises in this manner is called a \emph{principal ultrafilter}
% \end{defin}


\begin{defin}[Descending Chain Condition, non-terminating and principal]~\vspace{-6pt}
  \begin{itemize}
  \item An ultrafilter \(\alpha\) satisfies the \emph{descending chain condition} if all descending chains in \(\alpha\) become stationary.
  \item An ultrafilter is \emph{non-terminating} if every finite descending chain can be extended.
  \item Let \(X\) be a finite-dimensional CAT(0) cube complex and \(v \in X\) a vertex. Then
  \[
    \alpha_v \coloneqq \{\mathfrak{h} \in \mathcal{H}(X) \mid v \in \mathfrak{h}\}
  \]
  is called a \emph{principal ultrafilter} (see the next lemma).
  \end{itemize}
\end{defin}

\begin{lemma}
  \label{lem:principle-uf}
  Let \(X\) be a finite-dimensional CAT(0) cube complex and \(v \in X\) a vertex. Then \(\alpha_v\) is an ultrafilter. Furthermore, it satisfies the descending chain condition and every ultrafilter satisfying the descending chain condition arises in this way.
\end{lemma}

\begin{proof}
  Clearly, either \(\mathfrak{h}\) or \(\mathfrak{h}^\ast\) contains \(v\) such that \(\alpha_v\) lies in \(P(A)\). Furthermore, if \(\mathfrak{h} \in \alpha_v\) and \(\mathfrak{k} \in \mathcal{H}\) are such that \(\mathfrak{h} \subset \mathfrak{k}\), we have \(v \in \mathfrak{h} \subset \mathfrak{k}\). Hence \(\mathfrak{k} \in \alpha_v\) and \(\alpha_v\) satisfies the consistency condition. This shows that \(\alpha_v\) is an ultrafilter.

    If \(\alpha\) satisfies the descending chain condition, then each halfspace contains a minimal halfspace of \(\alpha\). If we take the set of minimal halfspaces of \(\alpha\), then all the elements must be pairwise transverse. Furthermore, since \(X\) is finite-dimensional, every set of pairwise transverse elements must be finite. By Theorem~\ref{thm:common-intersection}, we find that the intersection over all minimal elements is non-empty and contains a vertex \(v\). We claim that \(\alpha_v = \alpha\). Indeed, if \(\mathfrak{h} \in \alpha\), then there exists a minimal element \(\mathfrak{k} \in \alpha\) and \(v \in \mathfrak{k} \subset \mathfrak{h}\). Hence, \(\mathfrak{h} \in \alpha_v\). Conversely, if \(\mathfrak{h} \not \in \alpha\) then \(\mathfrak{h}^\ast \in \alpha\) and as before \(v \in \mathfrak{h}^\ast\) and \(\mathfrak{h} \not \in \alpha_v\).
\end{proof}

\begin{thm}[The Roller compactification]
  \label{thm:roller-compactification}
  Let \(X\) be a finite-dimensional CAT(0) cube complex with associated pocset \((\mathcal{H}, \subset, \ast)\). Let \(V(X)\) be the vertex set of \(X\). Then the map
  \begin{align*}
    \iota\colon V(X) &\hookrightarrow \mathcal{U}(\mathcal{H}),\\
    v &\mapsto \alpha_v
  \end{align*}
  is injective, continuous and the image is dense in \(\mathcal{U}(\mathcal{H})\). 
\end{thm}

\begin{defin}
  The \emph{Roller compactification} of a CAT(0) cube complex is \(\bar X \coloneqq \mathcal{U}(\mathcal{H})\). The \emph{Roller boundary} \(\partial X\) is the set of all ultrafilters which have at least one infinite descending chain (by abuse of notation one often writes \(\partial X \coloneqq \bar X \setminus X\)).
\end{defin}

\begin{proof}[Proof of Theorem~\ref{thm:roller-compactification}]
  The map is well-defined by Lemma~\ref{lem:principle-uf}. In order to see the injectivity, consider two vertices \(v \neq w\). There exists a halfspace \(\mathfrak{h}\) separating the two, i.\,e.\ \(v \in \mathfrak{h}\) and \(w \in \mathfrak{h}^\ast\). Hence, \(\mathfrak{h} \in \alpha_v\) and \(\mathfrak{h}^\ast \in \alpha_w\) and \(\alpha_v \neq \alpha_w\). The continuity is clear, since we have the discrete topology on \(V(X)\). Lastly, we have to show that the image is dense. We consider a basic open set \(\mathcal{U} \coloneqq \mathcal{U}(\mathfrak{h}_1, \dots, \mathfrak{h}_n)\) in \(\mathcal{U}(X)\). If \(\mathcal{U} \neq \varnothing\), then the \(\mathfrak{h}_i\) intersect pairwise. Otherwise, assume that \(\mathfrak{h}_i \cap \mathfrak{h}_j = \varnothing\). We have \(V(X) = \mathfrak{h}_i \sqcup \mathfrak{h}_i^\ast\). Hence, for any \(v \in \mathfrak{h}_j\) we have \(v \in \mathfrak{h}_i^\ast\). This yields \(\mathfrak{h}_j \subset \mathfrak{h}_i^\ast\). However, no ultrafilter can contain both \(\mathfrak{h}_i\) and \(\mathfrak{h}_i^\ast\). Now, we know by Theorem~\ref{thm:common-intersection} that \(\bigcap_{i=1}^n \mathfrak{h}_i\) contains a vertex \(v\) and hence \(\alpha_v \in \mathcal{U}\).
\end{proof}

\begin{rem}
  Many compactifications one encounters have an additional interesting property: The space itself is embedded as an \emph{open} subset of the compactification. In our case this can fail. Here is an example: Consider an infinite family of copies of the non-negative reals \(\R_{\geq0}\) with their standard cubulation. We glue these lines together at their respective origins (and call this vertex \(\ast\)). This construction leads to a tree and hence to a CAT(0) cube complex. We claim that any open neighborhood of the ultrafilter \(\alpha_\ast\) contains an ultrafilter which does not satisfy the descending chain condition. The construction is depicted in Figure~\ref{fig:roller-counterexample}
  \begin{figure}[htbp]
    \centering
    \input{./images/roller-counterexample.tex}
    \caption{The left-hand side depicts the ultrafilter \(\alpha_\ast\). The blue edges depict the halfspaces, determined by \(\mathcal{U}(\mathfrak{h}_1, \dots, \mathfrak{h}_n)\). The green branch contains no \(\mathfrak{h}_i\) and its halfspaces can therefore be reversed. This leads to the ultrafilter \(\alpha\) on the right-hand side.}
    \label{fig:roller-counterexample}
  \end{figure}

  Let \(\mathcal{U} \coloneqq \mathcal{U}(\mathfrak{h}_1, \dots, \mathfrak{h}_n)\) be any basic open set containing \(\alpha_\ast\). Then \(\mathfrak{h}_i \in \alpha_\ast\). We recall from Example~\ref{bsp:ccc-graph} that in the case of trees, halfspaces correspond to the choice of a direction at an edge and in the case of \(\alpha_\ast\) all arrows have to point towards \(\ast\). Since we have infinitely many branches with \(\ast\) as their root, but only finitely many arrows prescribed by the \(\mathfrak{h}_i\)'s, we can construct the following ultrafilter: We take \(\alpha_\ast\) and choose a branch which does not contain one of the edges with prescribed direction (the green branch in the figure). On this branch we reverse all arrows. This leads to a new ultrafilter \(\alpha\) (each vertex has at most one outgoing edge), which does not satisfy the descending chain condition, but nonetheless lies in \(\mathcal{U}\).
\end{rem}

\subsection{(Set-)Ultrafilters}
\label{sec:set-ultrafilters}

Now that we have defined the Roller compactification, we have to consider a second viewpoint. The advantage of the above construction was that the topological and metric properties were easy to establish. However, the disadvantage of the construction is that the ultrafilters are not simply sets or more precisely special subsets of \(\mathcal{H}(X)\), but elements in a product space. The new form has its advantages when it comes to measurability of certain maps. Therefore, we will establish this second viewpoint as well and prove the equivalence of the two.

\begin{defin}
  \label{def:pot-top}
  Let \(A\) be a set. Let \(F_1, F_2 \subset A\) be finite subsets. The set
  \begin{align*}
    \mathcal{C}(F_1, F_2) & \coloneqq \{ H \subset A \mid F_1 \subset H \text{ and } F_2 \subset A \setminus H\} \subset \operatorname{Pot}(A)
  \end{align*}
  is called a \emph{cylinder set}. We set \(\mathcal{C}(a) \coloneqq \mathcal{C}(\{a\}, \varnothing)\) for arbitrary \(a \in A\).
\end{defin}

\begin{prop}
  \label{prop:pot-top}
  The set of all cylinder sets is a basis for a topology on \(\operatorname{Pot}(A)\) for any set \(A\).
\end{prop}

\begin{proof}
  There are two properties we have to establish:
  \begin{enumerate}
  \item We have to show that the union of all cylinder sets is all of the power set. However, \(\mathcal{C}(\varnothing, \varnothing) = \operatorname{Pot}(A)\).
  \item We have to show that the intersection of two cylinder sets is a union of arbitrarily many cylinder sets. Thus let \(F_1, F_2, G_1, G_2 \subset A\) be finite and consider
  \begin{align*}
    \mathcal{C}(F_1, F_2) \cap \mathcal{C}(G_1, G_2)
    & = \{H \subset A \mid F_1 \cap G_1 \subset H \text{ and } F_2 \cap G_2 \subset A \setminus H\}\\
    & = \mathcal{C}(F_1 \cap G_1, F_2 \cap G_2).
  \end{align*}
  Since \(F_1 \cap G_1\) and \(F_2 \cap G_2\) are still finite we are done.
  \end{enumerate}
\end{proof}

\begin{defin}[(Set-)Ultrafilters]
  \label{defin:set-ultrafilters}
  Let \(X\) be a CAT(0) cube complex. We say that a subset \(\alpha \subset \mathcal{H} \coloneqq \mathcal{H}(X)\) satisfies:
  \begin{enumerate}
  \item the \emph{partial choice condition} if \(\alpha \cap \alpha^\ast = \varnothing\),
  \item the \emph{choice condition} if \(\alpha \cap \alpha^\ast = \varnothing\) and \(\alpha \sqcup \alpha^\ast = \mathcal{H}\) and
  \item the \emph{consistency condition} if whenever \(\mathfrak{h} \in \alpha\) and \(\mathfrak{k} \in \mathcal{H}\) such that \(\mathfrak{h} \subset \mathfrak{k}\) then \(\mathfrak{k} \in \alpha\).
  \end{enumerate}
  A \emph{(set-)ultrafilter} is a set \(\alpha \subset \mathcal{H}\) that satisfies the choicecondition and the consistency condition. We denote by \(\mathcal{U}_s(X) \subset \operatorname{Pot}(\mathcal{H}(X))\) the set of all (set-)ultrafilters and equip it with the subspace topology.
\end{defin}

\begin{lemma}
  The space \(\mathcal{U}_s(X)\) is a Hausdorff space.
\end{lemma}

\begin{proof}
  Let \(\alpha, \beta \in \mathcal{U}_s(X)\) and \(\alpha \neq \beta\). Then there exists \(\mathfrak{h} \in \alpha\) such that \(\mathfrak{h}^\ast \in \beta\) (choice condition). Next, let us define
  \begin{align*}
    U & \coloneqq \mathcal{C}(\mathfrak{h}^{\phantom{\ast}}) \cap \mathcal{U}_s(X)\quad \text{and}\\
    V & \coloneqq \mathcal{C}(\mathfrak{h}^\ast) \cap \mathcal{U}_s(X).
  \end{align*}
  By construction both sets are open and we have \(\alpha \in U\) and \(\beta \in V\). Furthermore, no (set-)ultrafilter can contain both \(\mathfrak{h}\) and \(\mathfrak{h}^\ast\). Thus \(U \cap V = \varnothing\). 
\end{proof}

\begin{thm}
  \label{thm:uf-equivalence}
  The spaces \(\mathcal{U}(X)\) and \(\mathcal{U}_s(X)\) are homeomorphic.
\end{thm}

\begin{proof}
  Consider the map
  \begin{align*}
    f\colon \mathcal{U}(X) &\to \mathcal{U}_s(X),\\
    (\mathfrak{h}_i)_{i \in \mathcal{\hat H}(X)} &\mapsto \{\mathfrak{h}_i \mid i \in \mathcal{\hat H}(X)\}.
  \end{align*}
  This map is well-defined and bijective. Next, let us show that it is continuous. Let \(\mathfrak{h}_1, \dots, \mathfrak{h}_n, \mathfrak{h'}_1, \dots,\mathfrak{h'}_k \in \mathcal{H}(X)\) and set
  \[
    U \coloneqq \mathcal{C}(\{\mathfrak{h}_1, \dots, \mathfrak{h}_n\}, \{\mathfrak{h'}_1, \dots, \mathfrak{h'}_k\}) \cap \mathcal{U}_s(X)
  \]
  which is a basic open set. Thus we have
  \begin{align*}
    f^{-1}(U)
    & = \{\alpha \in \mathcal{U}(X) \mid \mathfrak{h}_i \in \alpha \text{ and } \mathfrak{h'}_j \notin \alpha\}\\
    & = \{\alpha \in \mathcal{U}(X) \mid \mathfrak{h}_i, \mathfrak{h'}^\ast_j \in \alpha\}\\
    & = \mathcal{U}(\mathfrak{h}_1, \dots, \mathfrak{h}_n, \mathfrak{h'}^\ast_1, \dots, \mathfrak{h'}^\ast_k),
  \end{align*}
  which is a basic open set in \(\mathcal{U}(X)\). However, this already suffices to show that \(f\) is an homeomorphism. Indeed, every closed set \(A \subset \mathcal{U}(X)\) is compact (since \(\mathcal{U}(X)\) is) and as \(f\) is continuous \(f(A)\) is also compact. Lastly, as \(\mathcal{U}_s(X)\) is Hausdorff \(f(A)\) is also closed. This finishes the proof.
\end{proof}

\begin{rem}
  With the above theorem in place, we can switch viewpoints whenever necessary. Actually, whenever convenient we will \enquote{confuse} the two and stop to distinguish between ultrafilters and set-ultrafilters.
\end{rem}

\subsection{Intervals \& terminal elements}
\label{sec:terminal-elements}

In this section we will introduce \emph{intervals} of ultrafilters. These are special subsets of CAT(0) cube complexes. If they are interpreted as a complex in their own right, they can be embedded into some \(\R^d\) with its standard cubulation (see Theorem~\ref{thm:interval}).

Additionally, we will introduce \emph{terminal elements}. The existence or non-existence of these is one of the main technical tools in the proof of our main result. We will see that intervals can have at most finitely many terminal elements.

\begin{defin}
  \label{defin:uf-interval}
  Let \(\alpha,\beta \in \bar X\). The \emph{interval \([\alpha,\beta]\)} is defined as
  \[
    [\alpha,\beta] \coloneqq \bigcap_{\mathfrak{h} \in \alpha \cap \beta} \mathfrak{h} \subset X.
  \]
\end{defin}

\begin{lemma}
  \label{lem:x-interval}
  Let \(X\) be a finite-dimensional CAT(0) cube complex and \(\alpha \in \bar X\) an ultrafilter. If \(\alpha^\ast\) is an ultrafilter then \(X = [\alpha, \alpha^\ast]\).
\end{lemma}

\begin{proof}
  Since no halfspace can be contained in both \(\alpha\) and \(\alpha^\ast\), we have an empty intersection and thus \(X = [\alpha, \alpha^\ast]\).
\end{proof}

\begin{bsp}[Euclidean space]
  \label{bsp:euclidean-interval}
  The above lemma immediately shows that every \(\R^d\) with its standard cubulation is an interval. Indeed, every hyperplane \(\mathfrak{\hat h}\) is orthogonal to a coordinate axis given by a unit vector \(e_i\). We choose the halfspace \(\mathfrak{h}\) such that there exists a \(K>0\) such that \(\lambda e_i \in \mathfrak{h}\) for all \(\lambda > K\). This is an ultrafilter \(\alpha\) and the opposite \(\alpha^\ast\) is given by all the halfspaces such that there exists a \(K > 0\) such that \(-\lambda e_i \in \mathfrak{h}\) for all \(\lambda > K\). This is again an ultrafilter. 
\end{bsp}

\begin{thm}[{\cite[Theorem 1.14]{Brodzki2009}}]
  \label{thm:interval}
  Let \(X\) be a CAT(0) cube complex of finite dimension \(d\) and \([\alpha,\beta] \subset X\) an interval. Then \([\alpha,\beta]\) is isometrically embeddable in \(\R^d\) considered as a CAT(0) cube complex equipped with the edge metric.
\end{thm}

\begin{defin}
  \label{defin:separating}
  Let \(\alpha\) and \(\beta\) be two ultrafilters. The \emph{set of separating halfspaces} of \(\alpha\) and \(\beta\) is defined as
  \[
    \mathcal{H}(\alpha,\beta) \coloneqq \{\mathfrak{h} \in \mathcal{H} \mid \mathfrak{h} \in \alpha \text{ and } \mathfrak{h}^\ast \in \beta \text{ or vice versa}\}.
  \]
\end{defin}

\begin{rem}
  \label{rem:interval}
  Indeed we have that \(\mathcal{H}(\alpha,\beta) = \mathcal{H}([\alpha,\beta])\), i.\,e.\ the halfspaces separating \(\alpha\) and \(\beta\) are exactly the halfspaces of the interval \([\alpha,\beta]\).
\end{rem}

\begin{lemma}[{\cite[Lemma 1.16]{Brodzki2009}}]
  \label{lem:b-1.16}
  Let \(X\) be a CAT(0) cube complex of dimension \(d<\infty\) and \(\alpha, \beta \in \bar X\). Then we have
  \[
    \mathcal{H}(\alpha, \beta) = P_1 \sqcup \dots \sqcup P_d,
  \]
  where each \(P_i\) contains all the halfspaces whose associated hyperplanes are parallel. Some of the \(P_i\) might be empty.
\end{lemma}

\begin{rem}
  \label{rem:b-1.16}
  By construction, each of the non-empty \(P_i\) contains exactly two chains. The first by choosing an arbitrary element and considering all halfspaces that are comparable to this element. The second by involution on this chain.
\end{rem}

\begin{cor}[{\cite[Corollary~2.8]{fernÃ³s}}]
  \label{cor:finite-interval}
  Let \(X\) be a CAT(0) cube complex of (finite) dimension \(d\) and \(\alpha, \beta \in \bar X\). Then the set
  \[
    \{(\gamma, \delta) \in \bar X \times \bar X \mid [\gamma, \delta] = [\alpha, \beta]\}
  \]
  contains at most \(2^d\) elements.
\end{cor}

\begin{proof}
  As we noted in Remark~\ref{rem:interval}, \(\mathcal{H}(\alpha,\beta) = \mathcal{H}([\alpha, \beta])\). Because of the Roller duality, it is enough to work on the pocset of halfspaces. By Lemma~\ref{lem:b-1.16} we have the decomposition
  \[
    \mathcal{H}(\alpha, \beta) = P_1 \sqcup \dots \sqcup P_d.
  \]
  Any other elements \(\gamma, \delta \in \bar X\) with the same set of halfspaces must admit the same decomposition. Let \(\mathfrak{h}, \mathfrak{k} \in P_i\) and \(\mathfrak{h} \in \alpha\). Hence, \(\mathfrak{h}^\ast \in \beta\). If \(\mathfrak{h} \subset \mathfrak{k}\), then \(\mathfrak{k} \in \alpha\) because of the consistency condition. If \(\mathfrak{k} \subset \mathfrak{h}\) then \(\mathfrak{k}^\ast \in \beta\) because of the consistency condition and again we have \(\mathfrak{k} \in \alpha\). We see that \(\alpha\) contains a chain in \(P_i\)  and \(\beta\) contains the opposite chain (under involution, see Remark~\ref{rem:b-1.16}).

  However, the same is true for any other pair \((\gamma, \delta)\) having the same decomposition \(P_i\). Since each \(P_i\) contains 0 or 2 chains, we see that there are at most \(2^d\) possible choices of how these two chains might be divided between \(\gamma\) and \(\delta\).
\end{proof}

\begin{defin}
  \label{defin:tau}
  Let \(\mathcal{H}\) be the pocset of halfspaces of a CAT(0) cube complex and \(\mathcal{H}' \subset \mathcal{H}\) a subset. An element \(\mathfrak{h} \in \mathcal{H}'\) is called
  \begin{itemize}
  \item \emph{minimal in \(\mathcal{H}'\)} if for every \(\mathfrak{k} \in \mathcal{H'}\) we have either \(\mathfrak{k} \pitchfork \mathfrak{h},\ \mathfrak{h} \subset \mathfrak{k}\) or \(\mathfrak{h} \subset \mathfrak{k}^\ast\),
  \item \emph{maximal in \(\mathcal{H}'\)} if \(\mathfrak{h}^\ast\) is minimal in \(\mathcal{H}'\),
  \item \emph{terminal in \(\mathcal{H}'\)} if it is either minimal or maximal in \(\mathcal{H}'\).
  \end{itemize}
  Let \(\tau\colon \operatorname{Pot}(\mathcal{H}) \to \operatorname{Pot}(\mathcal{H})\) be the map that assigns to each subset of \(\mathcal{H}\) its set of terminal elements.
\end{defin}

\begin{bsp}\label{bsp:finite-terminal}~\vspace{-6pt}
  \begin{description}
  \item[DCC ultrafilters:] Every ultrafilter satisfying the descending chain condition contains minimal (and hence terminal) elements. If the CAT(0) cube complex is finite-dimensional, there can be at most finitely many transverse halfspaces and hence only finitely many minimal elements. In general, we cannot say anything about maximal elements in ultrafilters. 
  \item[Euclidean space:] In \(\R^d\) with its standard cubulation, we know that all halfspaces are parallel to coordinate axes and along each axis we can have at most one minimal and one maximal element. This implies that any subset of halfspaces of \(\R^d\) can have at most \(2d\) terminal elements. With the help of Theorem~\ref{thm:interval} this reasoning can be extended to intervals.
  \end{description}
\end{bsp}

\begin{lemma}[{\cite[Lemma~4.12]{MR3509968}}]
  \label{lem:4.12}
  Let \(\alpha\) and \(\beta\) be two ultrafilters and \(\mathfrak{h} \in \tau(\alpha)\). Then \(\mathfrak{h} \notin \beta\) if and only if \(\mathfrak{h} \in \tau(\mathcal{H}(\alpha,\beta))\).
\end{lemma}

\begin{proof}
  If \(\mathfrak{h} \in \beta\), then \(\mathfrak{h}\) does not separate \(\alpha\) and \(\beta\). Hence \(\mathfrak{h} \notin \mathcal{H}(\alpha, \beta)\) and also \(\mathfrak{h} \notin \tau(\mathcal{H}(\alpha, \beta))\). Conversely, assume \(\mathfrak{h} \notin \tau(\mathcal{H}(\alpha, \beta))\). If \(\mathfrak{h} \notin \mathcal{H}(\alpha, \beta)\) then \(\mathfrak{h} \in \beta\). Otherwise, \(\mathfrak{h}\) is not a terminal element in \(\mathcal{H}(\alpha, \beta)\). However, this is impossible since \(\mathfrak{h}\) is terminal in \(\alpha\).
\end{proof}

\subsection{Embeddings of the Roller compactification}
\label{sec:embedding-roller}
In Remark~\ref{rem:roller} we outlined the connection between discrete pocsets and CAT(0) cube complexes. We saw that each discrete pocset has a unique CAT(0) cube complex associated to it. Now, let \(X\) be any CAT(0) cube complex and \(\mathcal{H}\) its pocset of halfspaces. Then any involution invariant subset \(\mathcal{H}' \subset \mathcal{H}\) is a pocset in its own right with associated CAT(0) cube complex \(X'\). It is natural to ask under which circumstances it is possible to embed \(X'\) into \(X\). This section will establish a sufficient (but not necessarily necessary) condition by introducing the notion of a \emph{lifting decomposition}.
We will need this construction later in Section~\ref{sec:main-proof} in order to embed the Roller compactification of certain subcomplexes into the Roller compactification of the \enquote{parent}-complex. See Lemma~\ref{lem:roller-bnd-embedding}.

Unless noted otherwise \(X\) is a connected, locally countable, finite-dimensional CAT(0) cube complex.

\begin{defin}
  Let \(\mathcal{H}' \subset \mathcal{H} \coloneqq \mathcal{H}(X)\) be an involution invariant subset of halfspaces. A \emph{lifting decomposition} of \(\mathcal{H}'\) is a choice of a subset \(W \subset \mathcal{H} \setminus \mathcal{H}'\) satisfying the partial choice and consistency condition (see Definition~\ref{defin:set-ultrafilters}) and such that \(\mathcal{H} = \mathcal{H}' \sqcup W \sqcup W^\ast\).
\end{defin}

\begin{lemma}[{\cite[Lemma~2.6]{MR3509968}}]
  \label{lem:lifting}
  Let \(\mathcal{H}' \subset \mathcal{H} \coloneqq \mathcal{H}(X)\) be an involution invariant subset of halfspaces. Assume that \(\mathcal{H}'\) admits a lifting decomposition \(\mathcal{H} = \mathcal{H}' \sqcup W \sqcup W^\ast\). Then there is a continuous injective map
  \begin{align*}
    i\colon \bar X' \coloneqq \bar X(\mathcal{H}') & \to \bar X,\\
            \alpha & \mapsto \alpha \sqcup W,
  \end{align*}
  whose image is given by \(i(\bar X') = \cap_{\mathfrak{h} \in W} \mathcal{C}(\mathfrak{h})\) (c.\,f.\ Definition~\ref{def:pot-top}).

  Furthermore, if \(\mathcal{H}' = \varnothing\), then \(i(\bar X')\) is a point. If\ \(W\) contains an infinite descending chain, then \(i(\bar X') \subset \partial X\).
\end{lemma}

\begin{proof}
  We will work with the power set definition of the Roller compactification.

  Since \(\mathcal{H}'\) is involution invariant, it is a pocset in its own right and therefore we can construct a unique CAT(0) cube complex \(X'\) with \(\mathcal{H}'\) as its set of halfspaces (c.\,f.\ Remark~\ref{rem:roller}). First, we need to show that the above construction of the map is well-defined. Let \(\alpha' \in \bar X'\). We claim that \(\alpha \coloneqq \alpha' \sqcup W\) is an ultrafilter in \(\bar X\). First, we see that \(\alpha\) satisfies the choice condition. Indeed,
  \begin{align*}
    \alpha \cap \alpha^\ast
    & = (\alpha' \sqcup W) \cap (\alpha^\ast \sqcup W^\ast)\\
    & = (\alpha' \cap \alpha'^\ast) \sqcup (\alpha' \cap W^\ast) \sqcup (W \cap \alpha'^\ast) \sqcup (W \cap W^\ast)\\
    & = \varnothing\\
    \intertext{and}
    \alpha \sqcup \alpha^\ast
    & = (\alpha' \sqcup \alpha'^\ast) \sqcup W \sqcup W^\ast\\
    & = \mathcal{H}' \sqcup W \sqcup W^\ast\\
    & = \mathcal{H}.
  \end{align*}
  For the consistency condition, we proceed as follows. Let \(\mathfrak{h} \in \alpha\) and \(\mathfrak{k} \in \mathcal{H}\), such that \(\mathfrak{h} \subset \mathfrak{k}\). We have three cases:
  \begin{enumerate}
  \item If \(\mathfrak{k} \in \mathcal{H}'\), then \(\mathfrak{k} \in \alpha' \subset \alpha\) and we are done.
  \item If \(\mathfrak{k} \in W \subset \alpha\), there is nothing to prove.
  \item If \(\mathfrak{k} \in W^\ast\), we will find a contradiction. Indeed, we have \(\mathfrak{k}^\ast \subset \mathfrak{h}^\ast\) and \(W\) satisfies the consistency condition. Hence, \(\mathfrak{h}^\ast \in W\) and, equivalently, \(\mathfrak{h} \in W^\ast\). However, \(\alpha \cap W^\ast = \varnothing\) which is absurd.
  \end{enumerate}

  If \(\alpha' \neq \beta'\) in \(\mathcal{H}'\) then also \(\alpha \neq \beta\) in \(\mathcal{H}\) and \(i\) is injective. Next, let us consider the continuity of \(i\). Consider two finite subsets \(F_1, F_2 \subset \mathcal{H}\). These can be decomposed into \(F_i = G_i \sqcup E_i\), where \(G_i \subset \mathcal{H}'\) and \(E_i \subset W \sqcup W^\ast\). Then we have
  \[
    i^{-1}(C(F_1, F_2)) = C(G_1, G_2)
  \]
  and \(i\) is continuous.

  In order to compute the image, let us first show that \(i(\bar X') \subset \cap_{\mathfrak{h} \in W} \mathcal{C}(\mathfrak{h})\). Indeed, we have
  \[
    \alpha' \cap W = \bigcap_{\mathfrak{h} \in \alpha \sqcup W}\mathcal{C}(\mathfrak{h}) \subset \bigcap_{\mathfrak{h} \in W} \mathcal{C}(\mathfrak{h}).
  \]
  Conversely, if \(\alpha \in \cap_{\mathfrak{h} \in W}\mathcal{C}(\mathfrak{h})\), then \(W \subset \alpha\). Additionally, \((\alpha \setminus W) \cap W^\ast = \varnothing\) because of the choice condition. Hence \(\alpha' \coloneqq \alpha \setminus W \subset \mathcal{H}'\). We claim that \(\alpha'\) is an ultrafilter. The choice condition is satisfied, since it is satisfied by \(\alpha\). So let \(\mathfrak{h} \in \alpha'\) and \(\mathfrak{k} \in \mathcal{H}'\) such that \(\mathfrak{h} \subset \mathfrak{k}\). Hence \(\mathfrak{k} \in \alpha\) and \(\mathfrak{k} \notin W\). This shows that \(\mathfrak{k} \in \alpha'\) and \(\alpha'\) also satisfies the consistency condition.

  Since we are only interested in connected cube complexes, \(\mathcal{H}' = \varnothing\) implies that \(X'\) is only a single point. The same is true for \(\bar X'\) and its image under \(i\).

  If \(W\) contains an infinite descending chain, so does \(\alpha' \sqcup W\) and thus \(\alpha' \sqcup W \in \partial X\).
\end{proof}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../Master"
%%% ispell-local-dictionary: "en_US"
%%% End:
